---
title: "Summary and data overview"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(sf)
library(ggrepel)
library(scales)
library(shiny)
library(shinycssloaders)
library(ggiraph)
library(kableExtra)
library(rmapshaper)
library(cowplot)
library(DT)
library(htmlwidgets)
library(RColorBrewer)
library(extrafont)
library(lubridate)
library(zoo)

loadfonts()

```

<link rel="stylesheet" href="styles.css" type="text/css">


```{r loading jon docs and shapefiles, cache=TRUE, include=FALSE}
theme_bar <- theme_bw() +
  theme(panel.grid.major = element_line(color = "grey70", size = 0.1),
        panel.grid.minor = element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_text(face = "bold"),
        panel.border = element_blank(),
        legend.background = element_rect(fill = "transparent", color = "transparent"),
        legend.key = element_rect(fill = "transparent"),
        legend.key.size = unit(1, "lines"),
        legend.margin = margin(0,0,0,0),
        legend.title = element_blank(),
        legend.text = element_text(margin = margin(l = 2)),
        text = element_text(family = "Arial"))

theme_line <- theme_bw() +
  theme(legend.background = element_rect(fill = "transparent", color = "transparent"),
        legend.key = element_rect(fill = "transparent"),
        legend.text = element_text(margin = margin(l = 2)),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line(color = "grey70", size = 0.1),
        axis.ticks = element_blank(),
        axis.text = element_text(face = "bold"),
        panel.border = element_blank(),
        legend.margin = margin(0,0,0,0),
        legend.key.size = unit(1, "lines"),
        text = element_text(family = "Arial"))


theme_sf <- theme_bw() +
  theme(axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        panel.background = element_blank(),
        panel.grid.major = element_line(color = "white"),
        panel.border = element_blank(),
        plot.title = element_text(hjust = 0.5),
        legend.title = element_blank(),
        legend.text = element_text(margin = margin(l = 2)),
        legend.margin = margin(0,0,0,0),
        legend.key.size = unit(1, "lines"),
        text = element_text(family = "Arial"))

regions <- read_csv("Data/Join docs/county_regions.csv") %>%
    select(5,6) %>%
    unique() %>%
    mutate(edr = str_replace(edr, "  ", " "),
           planning.region = str_replace(planning.region, " Minnesota", ""),
           planning.region = fct_relevel(planning.region, "Northwest", "Northeast", "Central", "Seven County Mpls-St Paul", "Southwest", "Southeast"),
           edr = fct_relevel(edr, "EDR 1 - Northwest", "EDR 2 - Headwaters", "EDR 3 - Arrowhead", "EDR 4 - West Central", "EDR 5 - North Central", "EDR 6E- Southwest Central", "EDR 6W- Upper Minnesota Valley", "EDR 7E- East Central", "EDR 7W- Central", "EDR 8 - Southwest", "EDR 9 - South Central", "EDR 10 - Southeast", "EDR 11 - 7 County Twin Cities", "Minnesota"))

counties.regions <- read_csv("Data/Join docs/county_regions.csv") %>%
  mutate(countyfp = formatC(countyfp, width = 3, flag = "0"),
         Name = str_to_title(Name),
         Name = str_replace(Name, "Q", "q"),
         Name = str_replace(Name, "Of The", "of the"),
         Name = str_replace(Name, "Mcleod", "McLeod"),
         Dem_Desc = ifelse(Name == "Minnesota", "Minnesota", Dem_Desc) ,
         edr = str_replace(edr, "  ", " "),
         planning.region = str_replace(planning.region, " Minnesota", ""),
         planning.region = fct_relevel(planning.region, "Northwest", "Northeast", "Central", "Seven County Mpls-St Paul", "Southwest", "Southeast"),
         edr = fct_relevel(edr, "EDR 1 - Northwest", "EDR 2 - Headwaters", "EDR 3 - Arrowhead", "EDR 4 - West Central", "EDR 5 - North Central", "EDR 6E- Southwest Central", "EDR 6W- Upper Minnesota Valley", "EDR 7E- East Central", "EDR 7W- Central", "EDR 8 - Southwest", "EDR 9 - South Central", "EDR 10 - Southeast", "EDR 11 - 7 County Twin Cities", "Minnesota"))

color.ruca <- c("Entirely rural" = "#009933", "Town/rural mix" = "#99CC33", "Urban/town/rural mix" = "#CC9966", "Entirely urban" = "#754C29", "Minnesota" = "black")

color.pr <- c("Northwest" = "#4575b4","Northeast" = "#e0f3f8", "Central" = "#fee090", "Seven County Mpls-St Paul" = "#d73027", "Southwest" = "#91bfdb", "Southeast" = "#fc8d59", "Minnesota" = "black")

color.edr <- c("EDR 1 - Northwest" = "#b3cde3", "EDR 2 - Headwaters" = "#8c96c6", "EDR 3 - Arrowhead" = "#fe9929", "EDR 4 - West Central" = "#8856a7", "EDR 5 - North Central" = "#810f7c", "EDR 6E- Southwest Central" = "#e5f5f9", "EDR 6W- Upper Minnesota Valley" = "#bdc9e1", "EDR 7E- East Central" = "#99d8c9", "EDR 7W- Central" = "#2ca25f", "EDR 8 - Southwest" = "#74a9cf", "EDR 9 - South Central" = "#0570b0", "EDR 10 - Southeast" = "#d7301f", "EDR 11 - 7 County Twin Cities" = "#d8b365", "Minnesota" = "black")

color.pr.edr <- c ("Northwest" = "#4575b4","Northeast" = "#e0f3f8", "Central" = "#fee090", "Seven County Mpls-St Paul" = "#d73027", "Southwest" = "#91bfdb", "Southeast" = "#fc8d59", "Minnesota" = "black", "EDR 1 - Northwest" = "#b3cde3", "EDR 2 - Headwaters" = "#8c96c6", "EDR 3 - Arrowhead" = "#fe9929", "EDR 4 - West Central" = "#8856a7", "EDR 5 - North Central" = "#810f7c", "EDR 6E- Southwest Central" = "#e5f5f9", "EDR 6W- Upper Minnesota Valley" = "#bdc9e1", "EDR 7E- East Central" = "#99d8c9", "EDR 7W- Central" = "#2ca25f", "EDR 8 - Southwest" = "#74a9cf", "EDR 9 - South Central" = "#0570b0", "EDR 10 - Southeast" = "#d7301f", "EDR 11 - 7 County Twin Cities" = "#d8b365")

color.six <- c("#009933", "#4575b4", "grey", "#fee090", "#fc8d59", "#d73027")

```




<br>

# How has the pandemic impacted unemployment trends

* Unemployment claims exploded as heavy restrictions were put in place on businesses at the very beginning of the pandemic. In terms of share of the workforce, unemployment was heaviest in our northern portions of the state as well Central Minnesota due to the prevalence of tourism-related businesses in these regions. 

* Since this initial spike in unemployment claims, many of the occupation groups that were initially hit hard have "recovered". The occupation groups that continue to have high unemployment claims are;
  + Food preparation and serving related
  + Sales and related
  + Healthcare support
  + Production
  
* Unemployment claims have decreased significantly since their peak in Spring 2020. When comparing October 2020 unemployment rates with 2019, EDRs in western and southern Minnesota are about .6 to 1.5 percentage points higher. The difference between 2019 and 2020 rates in Northern Minnesota, particularly in our recreation and tourism areas area  bit higher. The rate continues to be significantly higher in the Seven-county Metro.

* Unemployment claims have increased a bit since their October lows due to more business restrictions put in place in November. From their October lows, they are about 1 percentage point higher across most EDRs.EDRs in Northwest planning region have seen a significant increase since October such as EDR 5 - North Central. EDR 7E - Central has also seen a significant increase in their unemployment claims since October. Going from 7% to 11% by December. However, when analyzing these increases compared to increases during these months in 2019, they aren't far off. These areas traditionally see increasing unemployment during this timeframe due to the seasonality of employment. From 2019, the unemployment rate is about .5 to 1.5 percentage points higher in 2020. The Seven-county metro continues to have the largest difference in their unemployment rate from 2019 to 2020 where it's closer to 2.5 percentage points higher.

* There is also concern about the decrease in unemployment rates and claims due to people dropping out of the workforce. A comparison of the number of people participating in the laborforce to January 2019 shows a definite impact. Many EDRs in Northeast, North Central, and the Seven County Metro have seen consistent decreases in their numbers of people participating in the laborforce since April 2020. However, in Southwest and some EDRS in Northwest Minnesota have seen steady increases since that time. Although, the increases are significantly dampened compared to the usual increase in the laborforce during the spring and summer months.

<br>

# How has the pandemic impacted the number of jobs available? 

* In 2019, job vacancy rates from the job vacancy survey was between 4% and 7% across Minnesota. Some of the highest job vacancy rates were in Southwest Minnesota.

* Comparing the 2019 job vacancy rates with the vacancy rate for September and October 2020 shows the rate was about 2 percentage points lower than their 2019 rates. This means job vacancy rates have been between 1% to 4% across Minnesota.

* The highest job vacancy rates still exist outside of the seven-county metro. In particular, rates are very high in EDRs in Southwest and Northwest Minnesota.

* The number of jobs available along with a decrease in the number of unemployment claims showed that by the end of October, there were nearly as many job openings as people filing continuous unemployment claims, particularly in our rural regions of the state - Southwest and Northwest. 

* However, due to rural areas having a greater share of seasonal workers, the number of job postings as a percentage of unemployment claims has decreased significantly since the end of October due to the traditional trend of increasing unemployment in November and December.

* Nearly every type of job was available across the state, but in different quantities. Even occupation groups with large number of unemployment claims had jobs available in them.

<br>

# What occupations have experienced workforce shortages during the pandemic?

* Each region is experiencing an increase in the number of occupation groups that experienced a workforce shortage April through October 2020. Regions on the western side of the state have faired better than other parts of Minnesota. Most of the EDRs in Northwest and Southwest Minnesota have 10 or more occupations with workforce shortages by the end of October. In addition, Southeast Minnesota is experiencing a nice increase in their numbers.

* The number of occupations facing workforce shortages has decreased since October. In Greater Minnesota, this is expected due to the seasonal nature of the employment.

* Parts of the state that are more reliant on recreation and retail tend to have a lower number of occupation groups experiencing workforce shortage. EDRs such as Northeast, EDR 5 - North Central, East Central and the seven county metro have 8 or less occupations with workforce shortages.

* The major disruptions the pandemic has had to certain industries has caused high unemployment and workforce surpluses in occupations that require a lower skill-set in every region. These occupation groups were also some of the most severe in terms of experiencing workforce surpluses.
  + Food preparation and serving related
  + Sales and related
  + Office and administrative support

* The skills needed for this type of employment don't typically align well with the skills required for many of the jobs in occupation groups that were experiencing a workforce shortage in nearly every region.
  + Healthcare practitioners and technical
  + community and social services
  + Architecture and engineering
  + Computer and mathematical
  + Life, physical, and social science

Other occupation groups that were experiencing more unemployment claims than job positions available but requires training and education;

+ Education, training, and library.
+ Healthcare support

* In addition, October is a transition month where many industries begin laying off workers for the winter. There were quite a few occupation groups that were experiencing a higher number of unemployment claims than job postings but is typical for this time of year across nearly all regions.
  + Production
  + Construction and extraction
  + Farming, fishing and forestry
  + Building and grounds cleaning and maintenance

* There are a few other occupation groups that show up in the rural EDRs that are a bit more complicated. These occupation groups can either show up as experiencing workforce surpluses or shortages depending on the region. It's challenging to determine what's causing this but it's likely due to the differences in industry make-up of each region and they specific types of product or service being produced. For example, transportation and material moving in Northwest and Southwest might be experiencing more unemployment claims in October due to their being less agricultural product to move while in Central these type of jobs are more linked to commerce and are gearing up for he holiday season.
  + Transportation and material moving
  + Management
  + Business and financial operations
  + Installation, maintenance and repair
  + Arts, design, entertainment, sports, and media
  + Personal care and service

What this tells us is that even though there are some main occupations being impacted by the pandemic, the workforce and industry dynamics are still quite complicated and nuanced. Even in a significant global even such as we are in right now, each workforce development organization is facing their own unique situation requiring individual strategies and programming. 

<br>

# How has the pandemic impacted job projections?

* The change in projections from before the pandemic to after the pandemic shows a severe disruption in the number of jobs compared to what was projected for 2020. The event-based model currently projects a relatively quick recovery (v-shape) but a continued gap between what is projected now that the pandemic has occurred compared to the models before the pandemic began. This is due to the likely closure and slow recovery of the business directly impacted by the pandemic such as restaurants, bars, retail and other related industries. 

* By 2025, the event-based model projects employment that is .5% to 2.0% less than what was originally projected before the pandemic.



# What specific occupations are driving these projections?

* The model projects occupation groups to either have widespread occupation shortages across the state or workforce surpluses. 

* The occupation groups that are currently experiencing workforce shortages and surpluses largely overlap with the occupation groups that are projected to experience shortages and surpluses.
  + Widespread workforce shortages
    + Healthcare practitioners and technical
    + Community and social services
    + Architecture and engineering
    + Life, physical and social sciences
  + Widespread workforce surpluses
    + Food preparation and serving related
    + Production
    + Sales and related
    + Building and grounds cleaning and maintenance
    + Office and admin support
    + Farming, fishing and forestry
    + Protective service
    + Personal care and service
    
* Transitions from either having workforce surpluses to shortages largely take place in rural Minnesota. 

* Some EDRs that were experiencing small workforce surpluses in specific occupation groups are projected to have those transition to experiencing workforce shortages. Here's that list and the number of EDRs where this transition is expected to happen.
  + Management (12 EDRs)
  + Business and financial operations (8 EDRs)
  + Healthcare support (8 EDRs)
  + Computer and mathematical (5 EDRs)
  + Education, training and library (5 EDRs)
  + Installation, maintenance and repair (4 EDRs)
  + Legal (4 EDRs)
  + Architecture and engineering (2 EDRs)
  
* Another transition category that has a number of occupation groups projected to experience is from having too many workers to having just enough - essentially they "recover". Here are the occupation groups that are projected to experience this transition along with the number of EDRs in which they are projected to experience this. All of these occupations require education, training and/or licensing.
  + Building and grounds cleaning and maintenance (12 EDRs)
  + Arts, design, entertainment, sports and media (4 EDRs)
  + Education, training and library (2 EDRs)
  + Healthcare support (2 EDRs)
  + Installation, maintenance and repair (2 EDRs)
  + Legal (1 EDR)
  + Business and financial operations (1 EDR)
  + Construction and extraction (5 EDRs) appear in this category and might as well be labeled as being stable entirely.

* There were a few occupation groups projected to experience is going from having just enough workers to not enough. Here are those occupation groups. All of the occupation groups require training, education and/or licensing.
  + Legal (3 EDRs)
  + Installation maintenance and repair (2 EDRs)
  + Computer and mathematical (1 EDR)
  + Architecture and engineering (1 EDR)
  + Life, physical, and social science (1 EDR)

* Lastly, there was the transition from not having enough workers to having too many which was occuring a few occupation groups on the western side of Minnesota. Here are those occupation groups.
  + Transportation and material moving (6 EDRs)
  + Personal care and service (5 EDRs)
  + Farming, fishing and forestry (2 EDRs)
  + Protective service (1 EDR)
  + Office and administrative support (1 EDR)
  
* Here’s a brief summary of the main specific occupations that are projected to have workforce shortages for any occupation group that’s in an EDR’s top-5 most severe shortage.
  + **Healthcare practitioners and technical (top-5 in 13 EDRs)**
    + Registered nurses (by far the highest need)
    + Pretty much everything else under this occupation group
  + **Management (top-5 in 13 EDRs)**
    + General and operations manager
    + Ag managers (especially on the western and southern parts of the state)
    + Personal service managers (entertainment etc) - particularly in north eastern part of the state
    + Financial managers
    + Construction managers
  + **Business and financial operations (top-5 in 12 EDRs)**
    + Management analysts
    + Accountants and auditors
    + Market research analysts
    + Compliance officers
    + Pretty broad overall. Many specific occupations.
  + **Community and social services (top-5 in 10 EDRs)**
    + Substance, abuse, behavioral disorder and mental health counselors
    + Marriage and family counselors
    + Social workers (in general)
  + **Computer and mathematical (top-5 in 7 EDRs)**
    + Software developers
    + Analysts (in general)
  + **Construction and extraction (top-5 in 4 EDRs)**
    + Carpenters
    + Plumbers, pipefitters and steamfitters
    + Trades (in general)
  + **Architecture and engineering (top-5 in 2 EDRs)**
    + Mechanical engineers
    + Industrial engineers
    + Civil engineers
  + **Healthcare support (top-5 in 2 EDRs)**
    + Medical assistants
    + Nursing assistants

* Here’s a brief summary of the main specific occupations that are projected to have workforce surpluses for any occupation group that’s in an EDR’s top-5 most severe surplus.
  + **Food preparation and serving related (top-5 in 13 EDRs)**
    + Fast food and counter workers
    + Waiters and waitresses
    + Bartenders
    + Pretty much every specific occupation within this occupation group
  + **Office and administrative support (top-5 in 13 EDRs)**
    + Pretty much every specific occupation
  + **Sales related (top-5 in 13 EDRs)**
    + Cashiers
    + Retail salespersons
  + **Transportation and material moving (top-5 in 13 EDRs)**
    + Laborers and freight, stock and material movers
    + Stockers and order tillers
    + Packers and packages
  + **Production (top-5 in 10 EDRs)**
    + Team assemblers (by far)
    + Pretty much all other specific occupations are listed. It’s why I have a hard time believing these projections. I just don’t see it.
  + **Personal care and service (top-5 in 3 EDRs)**
    + Childcare workers (really?! I don’t think so.)
    + Gambling services - particularly in EDR 2 - Headwaters and EDR 6W - Upper MN Valley
    + Amusement and recreation attendants - especially in north eastern Minnesota.


